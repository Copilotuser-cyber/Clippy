<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Nexus | Advanced AI Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #10a37f;
            --primary-dark: #0d8c6c;
            --sidebar: #202123;
            --chat-bg: #444654;
            --user-msg: #343541;
            --ai-msg: #444654;
            --text-light: #ececf1;
            --text-gray: #8e8ea0;
            --border: #565869;
            --admin-color: #ef4444;
            --premium-color: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--chat-bg);
            color: var(--text-light);
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background-color: var(--sidebar);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .new-chat-btn {
            margin: 10px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: transparent;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .new-chat-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .new-chat-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .chat-history-item {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 5px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-history-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .chat-history-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .sidebar-footer {
            padding: 12px;
            border-top: 1px solid var(--border);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
        }

        .user-info:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 28px;
            height: 28px;
            border-radius: 2px;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
        }

        .user-status {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 2px;
        }

        .status-admin {
            background-color: var(--admin-color);
            color: white;
        }

        .status-premium {
            background-color: var(--premium-color);
            color: black;
        }

        .status-free {
            background-color: var(--text-gray);
            color: white;
        }

        .upgrade-section {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .upgrade-section button {
            width: 100%;
            padding: 8px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .upgrade-section button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Group Chat Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: var(--sidebar);
            border-radius: 8px;
            width: 100%;
            max-width: 500px;
            padding: 24px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 20px;
            cursor: pointer;
        }

        .close-modal:hover {
            color: white;
        }

        /* Main Chat Area */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        .chat-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title {
            font-size: 16px;
            font-weight: 600;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .message {
            display: flex;
            gap: 24px;
            max-width: 100%;
        }

        .message-avatar {
            width: 30px;
            height: 30px;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .user-avatar-small {
            background-color: var(--primary);
        }

        .ai-avatar-small {
            background-color: #5436DA;
        }

        .message-content {
            flex: 1;
            line-height: 1.5;
            padding-top: 5px;
        }

        .chat-input-container {
            padding: 24px;
            position: relative;
        }

        .chat-input-box {
            position: relative;
        }

        .chat-input {
            width: 100%;
            padding: 12px 45px 12px 16px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background-color: #40414f;
            color: white;
            font-size: 16px;
            resize: none;
            max-height: 200px;
            min-height: 60px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .send-button {
            position: absolute;
            right: 12px;
            bottom: 12px;
            background: transparent;
            border: none;
            color: var(--text-gray);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }

        .send-button:hover {
            color: var(--primary);
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Auth Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .auth-container {
            background-color: var(--sidebar);
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            padding: 32px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .auth-tab {
            padding: 10px 0;
            flex: 1;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .auth-tab.active {
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 14px;
            color: var(--text-gray);
        }

        .form-group input {
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .auth-button {
            padding: 12px;
            border: none;
            border-radius: 6px;
            background-color: var(--primary);
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        .auth-button:hover {
            background-color: var(--primary-dark);
        }

        .auth-error {
            color: #ef4444;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        /* Admin Dashboard */
        .admin-dashboard {
            display: none;
            padding: 20px;
            background-color: var(--sidebar);
            height: 100vh;
            overflow-y: auto;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background-color: var(--chat-bg);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--text-gray);
            font-size: 14px;
        }

        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 16px;
        }

        .admin-tab {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .admin-tab.active {
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--chat-bg);
            border-radius: 8px;
            overflow: hidden;
        }

        .admin-table th, .admin-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .admin-table th {
            color: var(--text-gray);
            font-weight: 500;
            background-color: rgba(255, 255, 255, 0.05);
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }

        .btn-approve {
            background-color: var(--primary);
            color: white;
        }

        .btn-deny {
            background-color: #ef4444;
            color: white;
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 0 20px;
        }

        .welcome-title {
            font-size: 32px;
            margin-bottom: 16px;
        }

        .welcome-subtitle {
            font-size: 18px;
            color: var(--text-gray);
            margin-bottom: 32px;
            max-width: 600px;
        }

        .capabilities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            max-width: 800px;
            margin-bottom: 32px;
        }

        .capability-card {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 8px;
        }

        .capability-icon {
            font-size: 24px;
            margin-bottom: 12px;
            color: var(--primary);
        }

        /* Footer */
        .footer {
            padding: 20px;
            text-align: center;
            color: var(--text-gray);
            font-size: 14px;
            border-top: 1px solid var(--border);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }

        .footer-links a {
            color: var(--text-gray);
            text-decoration: none;
        }

        .footer-links a:hover {
            color: var(--primary);
        }

        /* Typing Indicator */
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--text-gray);
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .error-message {
            background-color: #ef4444;
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            text-align: center;
        }

        .success-message {
            background-color: var(--primary);
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Main App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <button class="new-chat-btn" id="new-chat-btn">
                <i class="fas fa-plus"></i> New chat
            </button>
            <button class="new-chat-btn" id="group-chat-btn" style="margin-top: 5px;">
                <i class="fas fa-users"></i> Create Group
            </button>
            <button class="new-chat-btn" id="admin-dashboard-btn" style="margin-top: 5px; display: none;">
                <i class="fas fa-cog"></i> Admin Dashboard
            </button>
            <div class="chat-history" id="chat-history">
                <!-- Chat history will be populated by JavaScript -->
            </div>
            <div class="sidebar-footer">
                <div class="user-info" id="user-info">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div class="user-details">
                        <div class="user-name" id="user-name">Guest</div>
                        <div class="user-status status-free" id="user-status">Not logged in</div>
                    </div>
                </div>
                <div class="upgrade-section" id="upgrade-section" style="display: none;">
                    <button id="request-premium-btn">Request Premium Access</button>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-title" id="chat-title">AI Nexus</div>
                <div id="chat-actions"></div>
            </div>

            <div class="chat-messages" id="chat-messages">
                <!-- Welcome screen when no chat is selected -->
                <div class="welcome-screen" id="welcome-screen">
                    <h1 class="welcome-title">AI Nexus</h1>
                    <p class="welcome-subtitle">Experience the power of advanced AI with our free chat platform. Save conversations, and unlock premium features with admin approval.</p>
                    
                    <div class="capabilities-grid">
                        <div class="capability-card">
                            <div class="capability-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <h3>Creative Thinking</h3>
                            <p>Brainstorm ideas, explore possibilities, and get inspired.</p>
                        </div>
                        <div class="capability-card">
                            <div class="capability-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <h3>Code Assistance</h3>
                            <p>Get help with programming, debugging, and code explanation.</p>
                        </div>
                        <div class="capability-card">
                            <div class="capability-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <h3>Learning Support</h3>
                            <p>Explain complex topics, answer questions, and provide examples.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-box">
                    <textarea class="chat-input" id="chat-input" placeholder="Message AI Nexus..." rows="1"></textarea>
                    <button class="send-button" id="send-button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Auth Modal -->
        <div class="auth-modal" id="auth-modal">
            <div class="auth-container">
                <div class="auth-tabs">
                    <div class="auth-tab active" id="login-tab">Login</div>
                    <div class="auth-tab" id="signup-tab">Sign Up</div>
                </div>
                <form class="auth-form" id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="auth-button">Login</button>
                    <div class="auth-error" id="login-error"></div>
                </form>
                <form class="auth-form" id="signup-form" style="display: none;">
                    <div class="form-group">
                        <label for="signup-name">Full Name</label>
                        <input type="text" id="signup-name" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" placeholder="Create a password (min 6 characters)" required>
                    </div>
                    <button type="submit" class="auth-button">Create Account</button>
                    <div class="auth-error" id="signup-error"></div>
                </form>
            </div>
        </div>

        <!-- Group Chat Modal -->
        <div class="modal" id="group-chat-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Create Group Chat</h2>
                    <button class="close-modal" id="close-group-modal">&times;</button>
                </div>
                <div class="form-group">
                    <label for="group-name">Group Name</label>
                    <input type="text" id="group-name" placeholder="Enter group name" required>
                </div>
                <div class="form-group">
                    <label for="group-members">Add Members (comma-separated emails)</label>
                    <input type="text" id="group-members" placeholder="email1@example.com, email2@example.com">
                    <small style="color: var(--text-gray);">Note: Members must be registered users</small>
                </div>
                <button class="auth-button" id="create-group-btn" style="width: 100%; margin-top: 20px;">Create Group</button>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div class="admin-dashboard" id="admin-dashboard">
            <div class="dashboard-header">
                <h1>Admin Dashboard</h1>
                <button class="auth-button" id="back-to-chat-btn">Back to Chat</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-users">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="premium-requests">0</div>
                    <div class="stat-label">Premium Requests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="approved-premium">0</div>
                    <div class="stat-label">Approved Premium</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-chats">0</div>
                    <div class="stat-label">Total Chats</div>
                </div>
            </div>
            
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="users">Users</div>
                <div class="admin-tab" data-tab="premium-requests">Premium Requests</div>
                <div class="admin-tab" data-tab="chats">Chats</div>
                <div class="admin-tab" data-tab="groups">Group Chats</div>
            </div>
            
            <div class="admin-table-container">
                <table class="admin-table" id="users-table">
                    <thead>
                        <tr>
                            <th>User ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body">
                        <!-- Users will be populated by JavaScript -->
                    </tbody>
                </table>
                
                <table class="admin-table" id="premium-requests-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>User ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Request Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="premium-requests-table-body">
                        <!-- Premium requests will be populated by JavaScript -->
                    </tbody>
                </table>
                
                <table class="admin-table" id="chats-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Chat ID</th>
                            <th>User</th>
                            <th>Title</th>
                            <th>Messages</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="chats-table-body">
                        <!-- Chats will be populated by JavaScript -->
                    </tbody>
                </table>

                <table class="admin-table" id="groups-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Group ID</th>
                            <th>Name</th>
                            <th>Created By</th>
                            <th>Members</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="groups-table-body">
                        <!-- Groups will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div>AI Nexus &copy; 2023 | Free AI Chat Platform</div>
        <div class="footer-links">
            <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank">YouTube</a>
            <a href="https://discord.gg/example" target="_blank">Discord</a>
            <a href="https://github.com/Copilotuser-cyber" target="_blank">GitHub</a>
        </div>
    </div>

    <script>
        // Firebase configuration - REPLACE WITH YOUR ACTUAL FIREBASE CONFIG
        const firebaseConfig = {
  apiKey: "AIzaSyA-7KtFeFcUndaOxdYxjTAzTsaBKvuOdDA",
  authDomain: "nexus-2842a.firebaseapp.com",
  projectId: "nexus-2842a",
  storageBucket: "nexus-2842a.firebasestorage.app",
  messagingSenderId: "888654157334",
  appId: "1:888654157334:web:9178855888bff2aaeac737",
  measurementId: "G-9F4JH2NYR0"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const authModal = document.getElementById('auth-modal');
        const loginTab = document.getElementById('login-tab');
        const signupTab = document.getElementById('signup-tab');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const loginError = document.getElementById('login-error');
        const signupError = document.getElementById('signup-error');
        const userInfo = document.getElementById('user-info');
        const userAvatar = document.getElementById('user-avatar');
        const userName = document.getElementById('user-name');
        const userStatus = document.getElementById('user-status');
        const requestPremiumBtn = document.getElementById('request-premium-btn');
        const upgradeSection = document.getElementById('upgrade-section');
        const welcomeScreen = document.getElementById('welcome-screen');
        const newChatBtn = document.getElementById('new-chat-btn');
        const groupChatBtn = document.getElementById('group-chat-btn');
        const adminDashboardBtn = document.getElementById('admin-dashboard-btn');
        const chatHistory = document.getElementById('chat-history');
        const adminDashboard = document.getElementById('admin-dashboard');
        const backToChatBtn = document.getElementById('back-to-chat-btn');
        const groupChatModal = document.getElementById('group-chat-modal');
        const closeGroupModal = document.getElementById('close-group-modal');
        const createGroupBtn = document.getElementById('create-group-btn');
        const groupNameInput = document.getElementById('group-name');
        const groupMembersInput = document.getElementById('group-members');

        // State variables
        let currentUser = null;
        let currentChatId = null;
        let isAdmin = false;
        let userData = null;

        // Event Listeners
        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        loginTab.addEventListener('click', () => switchAuthTab('login'));
        signupTab.addEventListener('click', () => switchAuthTab('signup'));
        loginForm.addEventListener('submit', handleLogin);
        signupForm.addEventListener('submit', handleSignup);
        userInfo.addEventListener('click', toggleUserMenu);
        requestPremiumBtn.addEventListener('click', requestPremiumAccess);
        newChatBtn.addEventListener('click', createNewChat);
        groupChatBtn.addEventListener('click', showGroupModal);
        adminDashboardBtn.addEventListener('click', showAdminDashboard);
        backToChatBtn.addEventListener('click', showChatInterface);
        closeGroupModal.addEventListener('click', () => groupChatModal.style.display = 'none');
        createGroupBtn.addEventListener('click', createGroupChat);

        // Initialize the app
        initApp();

        // Functions
        function initApp() {
            // Check if user is logged in
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    isAdmin = user.email === 'lkmukhil@gmail.com';
                    
                    // Load user data
                    await loadUserData();
                    
                    // Update UI for logged in user
                    updateUserInterface();
                    
                    // Hide auth modal
                    authModal.style.display = 'none';
                    
                    // Load user chats
                    loadUserChats();
                    
                } else {
                    // Show auth modal if not logged in
                    showAuthModal();
                    updateUserInterface();
                }
            });
        }

        function updateUserInterface() {
            if (currentUser) {
                userAvatar.textContent = currentUser.displayName ? currentUser.displayName.charAt(0).toUpperCase() : currentUser.email.charAt(0).toUpperCase();
                userName.textContent = currentUser.displayName || currentUser.email;
                
                // Update user status - ADMIN automatically gets premium
                if (isAdmin) {
                    userStatus.textContent = 'Admin';
                    userStatus.className = 'user-status status-admin';
                    upgradeSection.style.display = 'none';
                    // Admin automatically has premium access
                    if (userData) {
                        userData.isPremium = true;
                    }
                } else if (userData && userData.isPremium) {
                    userStatus.textContent = 'Premium';
                    userStatus.className = 'user-status status-premium';
                    upgradeSection.style.display = 'none';
                } else {
                    userStatus.textContent = 'Free User';
                    userStatus.className = 'user-status status-free';
                    upgradeSection.style.display = 'block';
                }
                
                // Show admin button if admin
                adminDashboardBtn.style.display = isAdmin ? 'block' : 'none';
                
                // Update group chat button - Admin and Premium users can create groups
                if ((userData && userData.isPremium) || isAdmin) {
                    groupChatBtn.disabled = false;
                    groupChatBtn.innerHTML = '<i class="fas fa-users"></i> Create Group';
                } else {
                    groupChatBtn.disabled = true;
                    groupChatBtn.innerHTML = '<i class="fas fa-users"></i> Premium Required';
                }
                
                // Update premium request button
                if (userData && userData.premiumRequested) {
                    requestPremiumBtn.disabled = true;
                    requestPremiumBtn.textContent = 'Request Pending';
                } else {
                    requestPremiumBtn.disabled = false;
                    requestPremiumBtn.textContent = 'Request Premium Access';
                }
            } else {
                userAvatar.textContent = 'U';
                userName.textContent = 'Guest';
                userStatus.textContent = 'Not logged in';
                userStatus.className = 'user-status status-free';
                upgradeSection.style.display = 'none';
                adminDashboardBtn.style.display = 'none';
            }
        }

        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    userData = userDoc.data();
                    // Ensure admin always has premium
                    if (isAdmin && !userData.isPremium) {
                        await db.collection('users').doc(currentUser.uid).update({
                            isPremium: true
                        });
                        userData.isPremium = true;
                    }
                } else {
                    // Create user document if it doesn't exist
                    userData = {
                        name: currentUser.displayName || currentUser.email,
                        email: currentUser.email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        isPremium: isAdmin, // Admin automatically gets premium
                        premiumRequested: false
                    };
                    await db.collection('users').doc(currentUser.uid).set(userData);
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function switchAuthTab(tab) {
            if (tab === 'login') {
                loginTab.classList.add('active');
                signupTab.classList.remove('active');
                loginForm.style.display = 'flex';
                signupForm.style.display = 'none';
            } else {
                loginTab.classList.remove('active');
                signupTab.classList.add('active');
                loginForm.style.display = 'none';
                signupForm.style.display = 'flex';
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                loginError.textContent = '';
            } catch (error) {
                loginError.textContent = error.message;
            }
        }

        async function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            if (password.length < 6) {
                signupError.textContent = 'Password must be at least 6 characters';
                return;
            }
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: name });
                
                const isNewUserAdmin = email === 'lkmukhil@gmail.com';
                
                // Create user document in Firestore
                await db.collection('users').doc(userCredential.user.uid).set({
                    name: name,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    isPremium: isNewUserAdmin, // Admin automatically gets premium
                    premiumRequested: false
                });
                
                signupError.textContent = '';
            } catch (error) {
                signupError.textContent = error.message;
            }
        }

        function showAuthModal() {
            authModal.style.display = 'flex';
        }

        function showGroupModal() {
            if (!currentUser) {
                alert('Please login to create group chats');
                return;
            }
            
            if (!userData.isPremium && !isAdmin) {
                alert('Premium access required for group chats. Please request premium access from admin.');
                return;
            }
            
            groupChatModal.style.display = 'flex';
        }

        async function createGroupChat() {
            const groupName = groupNameInput.value.trim();
            const members = groupMembersInput.value.trim();
            
            if (!groupName) {
                alert('Please enter a group name');
                return;
            }
            
            try {
                const groupData = {
                    name: groupName,
                    createdBy: currentUser.uid,
                    createdByEmail: currentUser.email,
                    members: [currentUser.email],
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    messages: []
                };
                
                // Add specified members
                if (members) {
                    const memberEmails = members.split(',').map(email => email.trim()).filter(email => email);
                    groupData.members = [...groupData.members, ...memberEmails];
                }
                
                const groupRef = await db.collection('groupChats').add(groupData);
                
                alert('Group chat created successfully!');
                groupChatModal.style.display = 'none';
                
                // Reset form
                groupNameInput.value = '';
                groupMembersInput.value = '';
                
            } catch (error) {
                console.error('Error creating group:', error);
                alert('Error creating group chat: ' + error.message);
            }
        }

        function toggleUserMenu() {
            if (currentUser) {
                const shouldLogout = confirm('Do you want to logout?');
                if (shouldLogout) {
                    handleLogout();
                }
            } else {
                showAuthModal();
            }
        }

        async function handleLogout() {
            try {
                await auth.signOut();
                currentUser = null;
                isAdmin = false;
                userData = null;
                chatHistory.innerHTML = '';
                chatMessages.innerHTML = '';
                welcomeScreen.style.display = 'flex';
                updateUserInterface();
            } catch (error) {
                console.error('Error signing out:', error);
            }
        }

        async function requestPremiumAccess() {
            if (!currentUser) {
                alert('Please login to request premium access');
                return;
            }
            
            if (isAdmin) {
                alert('You are an admin and already have premium access!');
                return;
            }
            
            try {
                await db.collection('premiumRequests').doc(currentUser.uid).set({
                    userId: currentUser.uid,
                    userName: currentUser.displayName || currentUser.email,
                    userEmail: currentUser.email,
                    requestedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'pending'
                });
                
                await db.collection('users').doc(currentUser.uid).update({
                    premiumRequested: true
                });
                
                await loadUserData();
                updateUserInterface();
                alert('Premium access request sent! Waiting for admin approval.');
            } catch (error) {
                console.error('Error requesting premium access:', error);
                alert('Error sending request. Please try again.');
            }
        }

        async function createNewChat() {
            if (!currentUser) {
                alert('Please login to create chats');
                return;
            }
            
            try {
                const chatRef = await db.collection('chats').add({
                    userId: currentUser.uid,
                    title: 'New Chat',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    messages: []
                });
                
                currentChatId = chatRef.id;
                await loadChat(currentChatId);
                await loadUserChats();
            } catch (error) {
                console.error('Error creating new chat:', error);
                // Create a local chat even if Firestore fails
                currentChatId = 'local-chat-' + Date.now();
                welcomeScreen.style.display = 'none';
                chatMessages.innerHTML = '';
                addMessageToChat("Hello! I'm AI Nexus, your advanced AI assistant. How can I help you today?", false);
                alert('New chat created! You can start chatting now.');
            }
        }

        async function loadUserChats() {
            if (!currentUser) return;
            
            try {
                const chatsSnapshot = await db.collection('chats')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                chatHistory.innerHTML = '';
                
                if (chatsSnapshot.empty) {
                    const noChatsElement = document.createElement('div');
                    noChatsElement.className = 'chat-history-item';
                    noChatsElement.textContent = 'No chats yet';
                    noChatsElement.style.opacity = '0.7';
                    noChatsElement.style.fontStyle = 'italic';
                    chatHistory.appendChild(noChatsElement);
                    return;
                }
                
                chatsSnapshot.forEach(doc => {
                    const chat = doc.data();
                    const chatElement = document.createElement('div');
                    chatElement.className = 'chat-history-item';
                    if (doc.id === currentChatId) {
                        chatElement.classList.add('active');
                    }
                    chatElement.textContent = chat.title;
                    chatElement.addEventListener('click', () => loadChat(doc.id));
                    
                    chatHistory.appendChild(chatElement);
                });
            } catch (error) {
                console.error('Error loading user chats:', error);
                const errorElement = document.createElement('div');
                errorElement.className = 'chat-history-item';
                errorElement.textContent = 'Error loading chats';
                errorElement.style.opacity = '0.7';
                errorElement.style.color = '#ef4444';
                chatHistory.appendChild(errorElement);
            }
        }

        async function loadChat(chatId) {
            if (!currentUser) return;
            
            try {
                const chatDoc = await db.collection('chats').doc(chatId).get();
                
                if (!chatDoc.exists) {
                    console.error('Chat not found');
                    return;
                }
                
                const chat = chatDoc.data();
                currentChatId = chatId;
                
                // Hide welcome screen
                welcomeScreen.style.display = 'none';
                
                // Clear chat messages
                chatMessages.innerHTML = '';
                
                // Update active chat in sidebar
                document.querySelectorAll('.chat-history-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelectorAll('.chat-history-item').forEach(item => {
                    if (item.textContent === chat.title) {
                        item.classList.add('active');
                    }
                });
                
                // Display chat messages
                if (chat.messages && chat.messages.length > 0) {
                    chat.messages.forEach(message => {
                        addMessageToChat(message.text, message.isUser);
                    });
                } else {
                    // Show welcome message if no messages
                    addMessageToChat("Hello! I'm AI Nexus, your advanced AI assistant. How can I help you today?", false);
                }
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            } catch (error) {
                console.error('Error loading chat:', error);
                // Still show the chat interface even if loading fails
                welcomeScreen.style.display = 'none';
                chatMessages.innerHTML = '';
                addMessageToChat("Hello! I'm AI Nexus, your advanced AI assistant. How can I help you today?", false);
            }
        }

        async function sendMessage() {
            const messageText = chatInput.value.trim();
            
            if (!messageText) return;
            
            if (!currentUser) {
                alert('Please login to send messages');
                return;
            }
            
            if (!currentChatId) {
                // Create a new chat if none exists
                await createNewChat();
                if (!currentChatId) return;
            }
            
            // Add user message to chat
            addMessageToChat(messageText, true);
            
            // Clear input
            chatInput.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Get current chat to update messages array
                const chatDoc = await db.collection('chats').doc(currentChatId).get();
                const chat = chatDoc.data();
                const messages = chat.messages || [];
                
                // Add user message
                messages.push({
                    text: messageText,
                    isUser: true,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update chat in Firestore
                await db.collection('chats').doc(currentChatId).update({
                    messages: messages,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Generate AI response using Hugging Face
                setTimeout(async () => {
                    try {
                        const aiResponse = await generateHuggingFaceResponse(messageText);
                        
                        // Remove typing indicator
                        removeTypingIndicator();
                        
                        // Add AI response to chat
                        addMessageToChat(aiResponse, false);
                        
                        // Add AI response to messages array
                        messages.push({
                            text: aiResponse,
                            isUser: false,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        // Update chat with AI response
                        await db.collection('chats').doc(currentChatId).update({
                            messages: messages,
                            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                    } catch (error) {
                        console.error('Error with AI response:', error);
                        removeTypingIndicator();
                        const fallbackResponse = generateFallbackResponse(messageText);
                        addMessageToChat(fallbackResponse, false);
                    }
                    
                }, 1000);
                
            } catch (error) {
                console.error('Error sending message:', error);
                removeTypingIndicator();
                const fallbackResponse = generateFallbackResponse(messageText);
                addMessageToChat(fallbackResponse, false);
            }
        }

        // Hugging Face AI Integration
        async function generateHuggingFaceResponse(userMessage) {
            try {
                // Using a free Hugging Face model - Microsoft's DialoGPT
                const response = await fetch(
                    'https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium',
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ${proccess.env.HF_TOKEN}', // Replace with your token
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            inputs: userMessage,
                            parameters: {
                                max_length: 1000,
                                temperature: 0.7,
                                do_sample: true
                            }
                        }),
                    }
                );

                const data = await response.json();
                
                // Handle different response formats from Hugging Face
                if (data[0] && data[0].generated_text) {
                    return data[0].generated_text;
                } else if (data.generated_text) {
                    return data.generated_text;
                } else if (data.error) {
                    console.warn('Hugging Face API error:', data.error);
                    return generateFallbackResponse(userMessage);
                } else {
                    return generateFallbackResponse(userMessage);
                }
            } catch (error) {
                console.error('Hugging Face API call failed:', error);
                return generateFallbackResponse(userMessage);
            }
        }

        function generateFallbackResponse(userMessage) {
            // Smart fallback responses when Hugging Face is unavailable
            const lowerMessage = userMessage.toLowerCase();
            
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                return "Hello! I'm AI Nexus, powered by advanced language models. How can I assist you today?";
            }
            
            if (lowerMessage.includes('how are you')) {
                return "I'm functioning well! As an AI assistant, I'm here to help you with questions, creative tasks, coding, learning, and much more. What would you like to explore?";
            }
            
            if (lowerMessage.includes('thank')) {
                return "You're welcome! I'm glad I could help. Is there anything else you'd like to know or discuss?";
            }
            
            if (lowerMessage.includes('bye') || lowerMessage.includes('goodbye')) {
                return "Goodbye! Feel free to return anytime you need assistance. Have a great day!";
            }
            
            // Contextual responses
            if (lowerMessage.includes('python') || lowerMessage.includes('javascript') || lowerMessage.includes('code')) {
                return "I can help with programming questions! I can explain concepts, provide code examples, help debug issues, or discuss best practices. What specific programming topic are you interested in?";
            }
            
            if (lowerMessage.includes('ai') || lowerMessage.includes('artificial intelligence')) {
                return "Artificial Intelligence involves creating systems that can perform tasks requiring human intelligence. This includes machine learning, natural language processing, computer vision, and more. I'm an example of AI designed to understand and generate human-like text!";
            }
            
            // Default intelligent response
            const responses = [
                "I understand your message. That's an interesting point - let me provide you with some helpful information about that.",
                "Thank you for sharing that. I've processed your input and here's what I think about this topic.",
                "I appreciate your question. Let me break this down and provide you with a comprehensive response.",
                "That's a valuable input. I'm considering various perspectives to give you the most helpful answer."
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function addMessageToChat(text, isUser) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            
            const avatarElement = document.createElement('div');
            avatarElement.className = `message-avatar ${isUser ? 'user-avatar-small' : 'ai-avatar-small'}`;
            avatarElement.innerHTML = isUser ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
            
            const contentElement = document.createElement('div');
            contentElement.className = 'message-content';
            contentElement.textContent = text;
            
            messageElement.appendChild(avatarElement);
            messageElement.appendChild(contentElement);
            
            chatMessages.appendChild(messageElement);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.className = 'message';
            typingElement.id = 'typing-indicator';
            
            typingElement.innerHTML = `
                <div class="message-avatar ai-avatar-small">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingElement = document.getElementById('typing-indicator');
            if (typingElement) {
                typingElement.remove();
            }
        }

        // ==================== ADMIN DASHBOARD ====================
        function showAdminDashboard() {
            document.querySelector('.app-container').style.display = 'none';
            document.querySelector('.footer').style.display = 'none';
            adminDashboard.style.display = 'block';
            loadAdminData();
        }

        function showChatInterface() {
            document.querySelector('.app-container').style.display = 'flex';
            document.querySelector('.footer').style.display = 'block';
            adminDashboard.style.display = 'none';
        }

        async function loadAdminData() {
            if (!isAdmin) return;
            
            try {
                // Load users
                const usersSnapshot = await db.collection('users').get();
                document.getElementById('total-users').textContent = usersSnapshot.size;
                
                const usersTableBody = document.getElementById('users-table-body');
                usersTableBody.innerHTML = '';
                
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${doc.id.substring(0, 8)}...</td>
                        <td>${user.name || 'No name'}</td>
                        <td>${user.email || 'No email'}</td>
                        <td>${user.isPremium ? 'Premium' : 'Free'}</td>
                        <td>
                            <button class="action-btn btn-approve" onclick="viewUserChats('${doc.id}')">View Chats</button>
                            ${!user.isPremium ? `<button class="action-btn btn-approve" onclick="approveUserPremium('${doc.id}')">Make Premium</button>` : ''}
                        </td>
                    `;
                    
                    usersTableBody.appendChild(row);
                });
                
                // Load premium requests
                const premiumRequestsSnapshot = await db.collection('premiumRequests').get();
                const pendingRequests = premiumRequestsSnapshot.docs.filter(doc => 
                    doc.data().status === 'pending' || !doc.data().status
                );
                
                document.getElementById('premium-requests').textContent = pendingRequests.length;
                
                const premiumRequestsTableBody = document.getElementById('premium-requests-table-body');
                premiumRequestsTableBody.innerHTML = '';
                
                if (pendingRequests.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="5" style="text-align: center; color: var(--text-gray);">No pending premium requests</td>`;
                    premiumRequestsTableBody.appendChild(row);
                } else {
                    pendingRequests.forEach(doc => {
                        const request = doc.data();
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${request.userId ? request.userId.substring(0, 8) + '...' : 'N/A'}</td>
                            <td>${request.userName || 'No name'}</td>
                            <td>${request.userEmail || 'No email'}</td>
                            <td>${request.requestedAt ? request.requestedAt.toDate().toLocaleDateString() : 'N/A'}</td>
                            <td>
                                <button class="action-btn btn-approve" onclick="approvePremiumRequest('${doc.id}', '${request.userId}')">Approve</button>
                                <button class="action-btn btn-deny" onclick="denyPremiumRequest('${doc.id}')">Deny</button>
                            </td>
                        `;
                        
                        premiumRequestsTableBody.appendChild(row);
                    });
                }
                
                // Load approved premium users count
                const approvedPremiumUsers = usersSnapshot.docs.filter(doc => doc.data().isPremium === true);
                document.getElementById('approved-premium').textContent = approvedPremiumUsers.length;
                
                // Load total chats count
                const chatsSnapshot = await db.collection('chats').get();
                document.getElementById('total-chats').textContent = chatsSnapshot.size;

                // Load group chats
                const groupsSnapshot = await db.collection('groupChats').get();
                const groupsTableBody = document.getElementById('groups-table-body');
                groupsTableBody.innerHTML = '';

                if (groupsSnapshot.empty) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="6" style="text-align: center; color: var(--text-gray);">No group chats created yet</td>`;
                    groupsTableBody.appendChild(row);
                } else {
                    groupsSnapshot.forEach(doc => {
                        const group = doc.data();
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${doc.id.substring(0, 8)}...</td>
                            <td>${group.name || 'Unnamed Group'}</td>
                            <td>${group.createdByEmail || 'Unknown'}</td>
                            <td>${group.members ? group.members.length : 0} members</td>
                            <td>${group.createdAt ? group.createdAt.toDate().toLocaleDateString() : 'N/A'}</td>
                            <td>
                                <button class="action-btn btn-approve" onclick="viewGroupChat('${doc.id}')">View</button>
                            </td>
                        `;
                        
                        groupsTableBody.appendChild(row);
                    });
                }
                
            } catch (error) {
                console.error('Error loading admin data:', error);
                const errorElement = document.createElement('div');
                errorElement.className = 'error-message';
                errorElement.innerHTML = `Error loading admin data: ${error.message}`;
                adminDashboard.insertBefore(errorElement, adminDashboard.firstChild);
            }
            
            // Initialize admin tabs
            initializeAdminTabs();
        }

        function initializeAdminTabs() {
            const tabs = document.querySelectorAll('.admin-tab');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Get the tab name
                    const tabName = this.getAttribute('data-tab');
                    
                    // Hide all tables
                    document.getElementById('users-table').style.display = 'none';
                    document.getElementById('premium-requests-table').style.display = 'none';
                    document.getElementById('chats-table').style.display = 'none';
                    document.getElementById('groups-table').style.display = 'none';
                    
                    // Show the selected table
                    const tableToShow = document.getElementById(`${tabName}-table`);
                    if (tableToShow) {
                        tableToShow.style.display = 'table';
                    }
                });
            });
            
            // Click the first tab to activate it
            if (tabs.length > 0) {
                tabs[0].click();
            }
        }

        // Admin action functions
        async function approvePremiumRequest(requestId, userId) {
            try {
                // Update user to premium
                await db.collection('users').doc(userId).update({
                    isPremium: true,
                    premiumRequested: false
                });
                
                // Update request status
                await db.collection('premiumRequests').doc(requestId).update({
                    status: 'approved',
                    approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert(' Premium access approved successfully!');
                loadAdminData();
            } catch (error) {
                console.error('Error approving premium:', error);
                alert(' Error approving premium access: ' + error.message);
            }
        }

        async function denyPremiumRequest(requestId) {
            try {
                // Update request status
                await db.collection('premiumRequests').doc(requestId).update({
                    status: 'denied',
                    deniedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert(' Premium request denied!');
                loadAdminData();
            } catch (error) {
                console.error('Error denying premium:', error);
                alert(' Error denying premium request: ' + error.message);
            }
        }

        async function approveUserPremium(userId) {
            try {
                await db.collection('users').doc(userId).update({
                    isPremium: true
                });
                
                alert(' User upgraded to premium successfully!');
                loadAdminData();
            } catch (error) {
                console.error('Error upgrading user:', error);
                alert(' Error upgrading user: ' + error.message);
            }
        }

        function viewUserChats(userId) {
            alert(` User Chats View\n\nUser ID: ${userId}\n\nThis would display all chat conversations for this user.`);
        }

        function viewGroupChat(groupId) {
            alert(` Group Chat View\n\nGroup ID: ${groupId}\n\nThis would display the group chat details and messages.`);
        }

        // Make functions global for admin buttons
        window.approvePremiumRequest = approvePremiumRequest;
        window.denyPremiumRequest = denyPremiumRequest;
        window.approveUserPremium = approveUserPremium;
        window.viewUserChats = viewUserChats;
        window.viewGroupChat = viewGroupChat;
    </script>
</body>
</html>
